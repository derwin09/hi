copilotedai@raspberrypi:~/Desktop/mshop-fridge-fix-video-length $ python3 run.py
üöÄ Starting MShop Fridge Camera Application...
üì¶ Checking dependencies...
Checking dependencies...
‚úÖ All dependencies are already installed.
üé• Starting camera application...
‚úÖ Using rpi-lgpio library (Pi 5 compatible RPi.GPIO replacement)
üöÄ Creating GPIO Controller V2...
üîç GPIO Controller V2 System Information:
   Platform: Linux-6.12.47+rpt-rpi-2712-aarch64-with-glibc2.41
   Python: 3.10.15
   Architecture: aarch64
   GPIO Library: rpi-lgpio
   Use GPIO: True
   Test Mode: False
   Transaction Pin: GPIO 26
   Alarm Pin: GPIO 19
   Light1 Pin: GPIO 12
üîß Initializing GPIO Controller V2...
   Setting up GPIO using rpi-lgpio...
   ‚úÖ GPIO.setmode(GPIO.BCM) successful
‚úÖ GPIO Controller V2 initialized successfully
üß™ Running startup test...
üß™ TESTING PIN 26 COMPREHENSIVE TEST
==================================================
Step 1: Setting up PIN 26 as output
üîß Setting up GPIO pin 26 as output
   ‚úÖ Pin 26 configured as OUTPUT (initialized LOW)
‚úÖ Pin 26 successfully configured as output
Step 2: Setting PIN 26 to HIGH
Step 3: Reading PIN 26 after HIGH
   Pin state after HIGH: True (HIGH)
Step 4: Setting PIN 26 to LOW
Step 5: Reading PIN 26 after LOW
   Pin state after LOW: False (LOW)
‚úÖ PIN 26 TEST PASSED
==================================================
‚úÖ GPIO Controller V2 startup test PASSED
üîß Initializing alarm pin (GPIO 19)...
üîß Setting up GPIO pin 19 as output
   ‚úÖ Pin 19 configured as OUTPUT (initialized LOW)
‚úÖ Pin 19 successfully configured as output
‚úÖ Alarm pin initialized successfully (OFF)
üîß Initializing Light 1 pin (GPIO 12)...
üîß Setting up GPIO pin 12 as output
   ‚úÖ Pin 12 configured as OUTPUT (initialized LOW)
‚úÖ Pin 12 successfully configured as output
‚úÖ Light 1 pin initialized successfully (OFF)
2025-12-17 18:57:05,143 - camera_app - INFO - Starting Camera Start Application
üîÑ INIT: Transaction Processor Initialized
‚å®Ô∏è  Press 'W' key to toggle alarm
üîß Setting up GPIO pin 13 as input
   ‚úÖ Pin 13 configured as INPUT
‚úÖ Pin 13 successfully configured as input
Found video devices: ['/dev/video0', '/dev/video1', '/dev/video2', '/dev/video3']
Camera 0 opened with FPS set to 30.0, actual FPS: 10.0
Found camera at index 0 (Resolution: 1280x720, FPS: 10.0)
[ WARN:0@2.275] global cap_v4l.cpp:914 open VIDEOIO(V4L2:/dev/video1): can't open camera by index
[ WARN:0@2.275] global cap.cpp:478 open VIDEOIO(V4L2): backend is generally available but can't be used to capture by index
[ WARN:0@2.276] global cap_v4l.cpp:914 open VIDEOIO(V4L2:/dev/video1): can't open camera by index
[ERROR:0@2.382] global obsensor_uvc_stream_channel.cpp:163 getStreamChannelGroup Camera index out of range
[ WARN:0@2.382] global cap_v4l.cpp:914 open VIDEOIO(V4L2:/dev/video1): can't open camera by index
[ERROR:0@2.384] global obsensor_uvc_stream_channel.cpp:163 getStreamChannelGroup Camera index out of range
Could not open camera at index 1 (/dev/video1)
Camera 2 opened with FPS set to 30.0, actual FPS: 10.0
Found camera at index 2 (Resolution: 1280x720, FPS: 10.0)
[ WARN:0@3.902] global cap_v4l.cpp:914 open VIDEOIO(V4L2:/dev/video3): can't open camera by index
[ WARN:0@3.902] global cap.cpp:478 open VIDEOIO(V4L2): backend is generally available but can't be used to capture by index
[ WARN:0@3.902] global cap_v4l.cpp:914 open VIDEOIO(V4L2:/dev/video3): can't open camera by index
[ERROR:0@3.903] global obsensor_uvc_stream_channel.cpp:163 getStreamChannelGroup Camera index out of range
[ WARN:0@3.904] global cap_v4l.cpp:914 open VIDEOIO(V4L2:/dev/video3): can't open camera by index
[ERROR:0@3.905] global obsensor_uvc_stream_channel.cpp:163 getStreamChannelGroup Camera index out of range
Could not open camera at index 3 (/dev/video3)
No device at /dev/video4
Total valid cameras found: 2
üîî Startup beep - system initialized successfully
Camera 2 (preview 0): Hardware FPS set to 30.0 (target recording: 10 FPS), actual: 10.0
Starting camera loop for preview 0
Camera 2 started successfully on attempt 1
Camera 0 (preview 1): Hardware FPS set to 30.0 (target recording: 10 FPS), actual: 10.0
Starting camera loop for preview 1
Camera 0 started successfully on attempt 1
üî• Firebase Event: PUT
Camera 1 failed to read frame
üö® Preview 1: cap.read() returned False
Camera loop ended for preview 1
Found video devices: ['/dev/video0', '/dev/video1', '/dev/video2', '/dev/video3']
Camera 0 opened with FPS set to 30.0, actual FPS: 10.0
Found camera at index 0 (Resolution: 1280x720, FPS: 10.0)
[ WARN:0@152.919] global cap_v4l.cpp:914 open VIDEOIO(V4L2:/dev/video1): can't open camera by index
[ WARN:0@152.920] global cap.cpp:478 open VIDEOIO(V4L2): backend is generally available but can't be used to capture by index
[ WARN:0@152.920] global cap_v4l.cpp:914 open VIDEOIO(V4L2:/dev/video1): can't open camera by index
[ERROR:0@152.921] global obsensor_uvc_stream_channel.cpp:163 getStreamChannelGroup Camera index out of range
[ WARN:0@152.921] global cap_v4l.cpp:914 open VIDEOIO(V4L2:/dev/video1): can't open camera by index
[ERROR:0@152.923] global obsensor_uvc_stream_channel.cpp:163 getStreamChannelGroup Camera index out of range
Could not open camera at index 1 (/dev/video1)
[ WARN:0@152.926] global cap_v4l.cpp:914 open VIDEOIO(V4L2:/dev/video2): can't open camera by index
[ WARN:0@152.926] global cap.cpp:478 open VIDEOIO(V4L2): backend is generally available but can't be used to capture by index
[ WARN:0@152.926] global cap_v4l.cpp:914 open VIDEOIO(V4L2:/dev/video2): can't open camera by index
[ERROR:0@152.928] global obsensor_uvc_stream_channel.cpp:163 getStreamChannelGroup Camera index out of range
[ WARN:0@152.928] global cap_v4l.cpp:914 open VIDEOIO(V4L2:/dev/video2): can't open camera by index
[ERROR:0@152.929] global obsensor_uvc_stream_channel.cpp:163 getStreamChannelGroup Camera index out of range
Could not open camera at index 2 (/dev/video2)
[ WARN:0@152.932] global cap_v4l.cpp:914 open VIDEOIO(V4L2:/dev/video3): can't open camera by index
[ WARN:0@152.933] global cap.cpp:478 open VIDEOIO(V4L2): backend is generally available but can't be used to capture by index
[ WARN:0@152.933] global cap_v4l.cpp:914 open VIDEOIO(V4L2:/dev/video3): can't open camera by index
[ERROR:0@152.934] global obsensor_uvc_stream_channel.cpp:163 getStreamChannelGroup Camera index out of range
[ WARN:0@152.934] global cap_v4l.cpp:914 open VIDEOIO(V4L2:/dev/video3): can't open camera by index
[ERROR:0@152.936] global obsensor_uvc_stream_channel.cpp:163 getStreamChannelGroup Camera index out of range
Could not open camera at index 3 (/dev/video3)
No device at /dev/video4
Total valid cameras found: 1
Camera 0 (preview 1): Hardware FPS set to 30.0 (target recording: 10 FPS), actual: 10.0
Starting camera loop for preview 1
Camera 0 started successfully on attempt 1
üî• Firebase Event: PUT
üì± Processed Event: MATCH | picking_status: started | STAGE: idle
üöÄ Starting transaction with ID: [-OgfxzEIer_HbmKB5O0R] from event: put
üîÑ STAGE 2: TRANSACTION_STARTED - New transaction initiated - [-OgfxzEIer_HbmKB5O0R]
[h264_v4l2m2m @ 0x555639959dc0] Could not find a valid device
[h264_v4l2m2m @ 0x555639959dc0] can't configure encoder
[ERROR:0@206.421] global cap_ffmpeg_impl.hpp:3268 open Could not open codec h264_v4l2m2m, error: Unspecified error (-22)
[ERROR:0@206.421] global cap_ffmpeg_impl.hpp:3285 open VIDEOIO/FFMPEG: Failed to initialize VideoWriter
Failed to create video writer for camera 0 (path=recording/-OgfxzEIer_HbmKB5O0R/camera_0_20251217_190030.mp4, fourcc=avc1, fps=7, size=(1280,720))
[h264_v4l2m2m @ 0x555639962060] Could not find a valid device
[h264_v4l2m2m @ 0x555639962060] can't configure encoder
[ERROR:0@206.439] global cap_ffmpeg_impl.hpp:3268 open Could not open codec h264_v4l2m2m, error: Unspecified error (-22)
[ERROR:0@206.439] global cap_ffmpeg_impl.hpp:3285 open VIDEOIO/FFMPEG: Failed to initialize VideoWriter
Failed to create video writer for camera 1 (path=recording/-OgfxzEIer_HbmKB5O0R/camera_1_20251217_190030.mp4, fourcc=avc1, fps=7, size=(1280,720))
No cameras available for recording
‚ùå Failed to start recording
üîÑ STAGE 3: DOOR_UNLOCK - Energizing door lock - [-OgfxzEIer_HbmKB5O0R]
üî• Firebase Event: PATCH
üî• Firebase Event: PATCH
üî• Firebase Event: PATCH
üî• Firebase Event: PATCH
üì± Processed Event: PATCH | picking_status: cancelled | STAGE: door_unlock


